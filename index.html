<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#3b82f6">
    <title>í† ìŠ¤ í™˜ìœ¨ ìŠ¤ìº˜í¼ Pro+ (AI ì´ìŠˆ ì²´í¬)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        .gradient-bg { background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%); }
        .card-shadow { box-shadow: 0 10px 30px -10px rgba(30, 64, 175, 0.2); }
        
        .price-input {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: #f8fafc;
        }
        .price-input:focus {
            background: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }

        /* Sentiment Buttons Style */
        .sent-btn { 
            @apply flex-1 py-2.5 rounded-xl text-[11px] font-black border transition-all flex flex-col items-center gap-1;
            background: white;
            color: #94a3b8;
            border-color: #e2e8f0;
        }
        .sent-btn i { @apply text-xs opacity-50; }

        /* Active States */
        .sent-btn.active-up { 
            background: #ef4444; color: white; border-color: #ef4444; 
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        .sent-btn.active-up i { opacity: 1; }

        .sent-btn.active-down { 
            background: #3b82f6; color: white; border-color: #3b82f6;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .sent-btn.active-down i { opacity: 1; }

        .sent-btn.active-flat { 
            background: #64748b; color: white; border-color: #64748b;
        }
        .sent-btn.active-flat i { opacity: 1; }

        .result-enter { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes slideUp { to { opacity: 1; transform: translateY(0); } }

        /* AI Pulse Animation */
        .ai-pulse { animation: pulse-blue 2s infinite; }
        @keyframes pulse-blue { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
    </style>
</head>
<body class="bg-slate-50 min-h-screen pb-10">

    <div class="max-w-md mx-auto min-h-screen bg-white shadow-2xl md:min-h-0 md:rounded-[2rem] md:my-8 md:border md:border-slate-100 overflow-hidden relative">
        
        <!-- Header -->
        <div class="gradient-bg p-6 pb-8 text-white rounded-b-[2.5rem] shadow-lg relative z-10">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-black tracking-tight"><i class="fas fa-brain mr-2 opacity-80 text-yellow-300"></i>í† ìŠ¤ ìŠ¤ìº˜í¼ Pro+</h1>
                    <p class="text-blue-100 text-xs mt-1 font-medium opacity-90">AI ì´ìŠˆ ìë™ ë¶„ì„ ì‹œìŠ¤í…œ</p>
                </div>
                <button onclick="toggleSettings()" class="bg-white/10 backdrop-blur-md w-10 h-10 rounded-full border border-white/20 flex items-center justify-center hover:bg-white/20 transition-all">
                    <i class="fas fa-cog text-white"></i>
                </button>
            </div>

            <!-- Currency Selector -->
            <div class="flex p-1 bg-blue-900/50 rounded-xl backdrop-blur-sm border border-white/10">
                <button onclick="setCurrency('usd')" id="btn-usd" class="flex-1 py-2.5 rounded-lg text-sm font-bold transition-all bg-white text-blue-600 shadow-sm">
                    ë¯¸êµ­ ë‹¬ëŸ¬ (USD)
                </button>
                <button onclick="setCurrency('jpy')" id="btn-jpy" class="flex-1 py-2.5 rounded-lg text-sm font-bold transition-all text-blue-100 hover:text-white">
                    ì¼ë³¸ ì—” (JPY)
                </button>
            </div>
        </div>

        <!-- âš™ï¸ Settings Section -->
        <div id="settings-area" class="hidden px-6 -mt-6 relative z-30 mb-4 result-enter">
            <div class="bg-slate-800 text-white rounded-2xl p-5 shadow-2xl border border-slate-700">
                <h3 class="text-xs font-bold text-slate-400 mb-2 flex items-center"><i class="fas fa-key mr-2"></i>AI API Key ì„¤ì •</h3>
                <div class="flex gap-2 mb-2">
                    <input type="password" id="api-key-input" placeholder="Gemini API í‚¤ ì…ë ¥" class="flex-1 bg-slate-700 border border-slate-600 text-white text-xs p-2 rounded-lg outline-none">
                    <button onclick="saveApiKey()" class="bg-blue-600 text-white text-xs px-3 py-2 rounded-lg font-bold">ì €ì¥</button>
                </div>
                <p id="key-status" class="text-[9px] text-slate-500">í‚¤ë¥¼ ì…ë ¥í•´ì•¼ AI ì´ìŠˆ ì²´í¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
            </div>
        </div>

        <!-- ğŸ”¥ Step 1: Fundamental Sentiment -->
        <div class="px-6 -mt-6 relative z-20 mb-6" id="main-content">
            <div class="bg-white rounded-2xl p-5 card-shadow border border-slate-100 ring-2 ring-blue-500/5">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xs font-black text-slate-600 flex items-center">
                        <i class="fas fa-newspaper text-blue-500 mr-2"></i>STEP 1. ì‹œì¥ ì‹¬ë¦¬ ê°€ì¤‘ì¹˜
                    </h3>
                    <div class="flex items-center gap-1">
                        <span class="text-[9px] font-black text-orange-500 uppercase">Volatility Mode</span>
                        <input type="checkbox" id="vol-mode" class="w-4 h-4 accent-orange-500 cursor-pointer">
                    </div>
                </div>
                
                <div class="space-y-4">
                    <!-- DXY Sentiment -->
                    <div class="flex flex-col gap-2">
                        <div class="flex justify-between items-center px-1">
                            <span class="text-[11px] font-bold text-slate-500"><i class="fas fa-chart-line mr-1 text-green-500"></i>ë‹¬ëŸ¬ ì¸ë±ìŠ¤ (DXY) ì¶”ì„¸</span>
                            <a href="https://kr.investing.com/currencies/us-dollar-index" target="_blank" class="text-[9px] text-blue-400 font-bold underline">ì‹¤ì‹œê°„ ì°¨íŠ¸</a>
                        </div>
                        <div class="flex gap-1.5" id="ctrl-dxy">
                            <button onclick="setBias('dxy', 'up')" class="sent-btn" id="dxy-up">
                                <i class="fas fa-arrow-up"></i>ê°•ì„¸(ë¹¨ê°•)
                            </button>
                            <button onclick="setBias('dxy', 'flat')" class="sent-btn active-neutral" id="dxy-flat">
                                <i class="fas fa-minus"></i>ë³´í•©
                            </button>
                            <button onclick="setBias('dxy', 'down')" class="sent-btn" id="dxy-down">
                                <i class="fas fa-arrow-down"></i>ì•½ì„¸(íŒŒë‘)
                            </button>
                        </div>
                    </div>
                    
                    <!-- USD/JPY Sentiment (JPY tab only) -->
                    <div id="row-usdjpy" class="hidden flex flex-col gap-2 border-t pt-3 border-slate-50">
                        <div class="flex justify-between items-center px-1">
                            <span class="text-[11px] font-bold text-slate-500"><i class="fas fa-coins mr-1 text-purple-500"></i>ì—”/ë‹¬ëŸ¬ (USD/JPY) ì¶”ì„¸</span>
                            <a href="https://kr.investing.com/currencies/usd-jpy" target="_blank" class="text-[9px] text-blue-400 font-bold underline">ì‹¤ì‹œê°„ ì°¨íŠ¸</a>
                        </div>
                        <div class="flex gap-1.5" id="ctrl-usdjpy">
                            <button onclick="setBias('usdjpy', 'up')" class="sent-btn" id="usdjpy-up">
                                <i class="fas fa-arrow-up"></i>ì—”ì €(ìƒìŠ¹)
                            </button>
                            <button onclick="setBias('usdjpy', 'flat')" class="sent-btn active-neutral" id="usdjpy-flat">
                                <i class="fas fa-minus"></i>ë³´í•©
                            </button>
                            <button onclick="setBias('usdjpy', 'down')" class="sent-btn" id="usdjpy-down">
                                <i class="fas fa-arrow-down"></i>ì—”ê³ (í•˜ë½)
                            </button>
                        </div>
                    </div>

                    <!-- AI Auto Check Section -->
                    <div class="pt-2 border-t border-slate-50">
                        <button onclick="autoCheckNews()" class="ai-pulse w-full bg-blue-50 text-blue-600 py-3 rounded-xl text-xs font-black flex items-center justify-center gap-2 hover:bg-blue-100 transition-all">
                            <i class="fas fa-magic"></i> âœ¨ AI ì‹¤ì‹œê°„ ì´ìŠˆ ì²´í¬ (ìë™)
                        </button>
                        <div id="news-loading" class="hidden mt-2 text-center py-2">
                             <i class="fas fa-circle-notch fa-spin text-blue-400 mr-2"></i><span class="text-[10px] text-slate-400 font-bold">ìµœì‹  ë‰´ìŠ¤ë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</span>
                        </div>
                        <textarea id="news-context" rows="2" class="w-full mt-2 bg-slate-50 text-[11px] p-3 rounded-xl border border-slate-100 outline-none focus:border-blue-300 font-medium leading-relaxed" 
                            placeholder="AIê°€ ë¶„ì„í•œ ì‹œì¥ í•µì‹¬ ì´ìŠˆê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."></textarea>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Price Input -->
        <div class="px-6 relative z-20 mb-8">
            <div class="bg-white rounded-2xl p-6 card-shadow border border-slate-100">
                <div class="flex justify-between items-center mb-2 ml-1">
                    <label class="text-xs font-black text-slate-600 uppercase tracking-wide">STEP 2. í˜„ì¬ í† ìŠ¤ë±…í¬ ê°€ê²©</label>
                </div>
                <div class="relative">
                    <input type="number" inputmode="decimal" id="price-input" 
                        class="price-input w-full text-4xl font-black text-slate-800 p-4 pr-12 rounded-2xl border-2 border-slate-100 outline-none focus:border-blue-500 placeholder-slate-200"
                        placeholder="0">
                    <span class="absolute right-5 top-1/2 -translate-y-1/2 text-slate-400 font-bold">ì›</span>
                </div>
                
                <button onclick="analyzePrice()" class="w-full mt-5 bg-blue-700 text-white font-black py-4 rounded-2xl hover:bg-blue-800 active:scale-[0.98] transition shadow-xl flex justify-center items-center gap-3 text-lg">
                    <i class="fas fa-bolt text-yellow-300"></i> ë§ˆì§„ íƒ€ê²© ë¶„ì„
                </button>
            </div>
        </div>

        <!-- Analysis Result Section -->
        <div id="result-area" class="hidden px-6 mt-2 space-y-6 pb-12">
            <!-- Verdict -->
            <div class="result-enter">
                <div class="bg-white border border-slate-100 rounded-2xl p-5 card-shadow relative overflow-hidden">
                    <div id="verdict-bg" class="absolute top-0 left-0 w-2 h-full bg-slate-400"></div>
                    <div class="flex justify-between items-start pl-3">
                        <div>
                            <div class="flex items-center gap-2 mb-1">
                                <p class="text-xs text-slate-400 font-bold uppercase tracking-wider">AI Expert Verdict</p>
                                <span id="vol-badge" class="hidden text-[9px] px-1.5 py-0.5 rounded-full bg-orange-100 text-orange-600 font-black tracking-tighter">ë³€ë™ì„± ëª¨ë“œ</span>
                            </div>
                            <h2 id="verdict-title" class="text-2xl font-black text-slate-800 tracking-tighter">ë°ì´í„° ë¶„ì„ ì¤‘...</h2>
                            <p id="verdict-desc" class="text-sm text-slate-500 mt-1 font-medium leading-tight">ì„ í–‰ ì§€í‘œì˜ ê°€ì¤‘ì¹˜ë¥¼ ê³„ì‚°í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                        <div id="verdict-icon" class="text-4xl"></div>
                    </div>
                </div>
            </div>

            <!-- Scalping Targets -->
            <div class="result-enter" style="animation-delay: 0.1s">
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-blue-50 p-4 rounded-2xl border border-blue-100 relative overflow-hidden">
                        <span class="text-xs font-black text-blue-400 block mb-1">ë§¤ìˆ˜ ì§„ì…ê°€</span>
                        <div id="target-entry" class="text-2xl font-black text-blue-700">---</div>
                        <div id="entry-gap" class="text-[10px] text-blue-400 font-bold mt-1">---</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-2xl border border-red-100 relative overflow-hidden">
                        <span class="text-xs font-black text-red-400 block mb-1">ë§¤ë„ ëª©í‘œê°€</span>
                        <div id="target-exit" class="text-2xl font-black text-red-700">---</div>
                        <div id="profit-calc" class="text-[10px] text-red-400 font-bold mt-1">---</div>
                    </div>
                </div>
            </div>

            <!-- AI Commentary -->
            <div class="result-enter" style="animation-delay: 0.2s">
                <div class="bg-slate-900 rounded-2xl p-6 border border-slate-700 shadow-2xl relative">
                    <div class="absolute top-4 right-5 text-blue-400/20">
                        <i class="fas fa-robot text-3xl"></i>
                    </div>
                    <h3 class="text-xs font-bold text-blue-400 mb-3 flex items-center gap-2 uppercase tracking-widest">
                        <span class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"></span> AI Analyst Briefing
                    </h3>
                    <div id="ai-comment" class="text-sm text-slate-200 leading-relaxed font-medium">
                        ë¶„ì„ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
                    </div>
                </div>
            </div>
        </div>

        <!-- Loader -->
        <div id="loading-overlay" class="hidden absolute inset-0 bg-white/90 backdrop-blur-md z-[100] flex flex-col items-center justify-center">
            <div class="w-16 h-16 relative">
                <div class="absolute inset-0 border-4 border-blue-100 rounded-full"></div>
                <div class="absolute inset-0 border-4 border-blue-600 rounded-full border-t-transparent animate-spin"></div>
            </div>
            <p class="mt-6 text-blue-800 font-black text-sm tracking-widest animate-pulse uppercase">Calculating Strategy...</p>
        </div>

    </div>

    <script>
        // --- Configuration & State ---
        const HISTORY_API = 'https://api.frankfurter.app';
        let currentCurrency = 'usd';
        let historicalData = { usd: [], jpy: [] };
        let macroBias = { dxy: 'flat', usdjpy: 'flat' };

        document.addEventListener('DOMContentLoaded', () => {
            fetchHistoricalData();
            setCurrency('usd'); 
            
            const savedKey = localStorage.getItem('gemini_api_key');
            if (savedKey) {
                document.getElementById('key-status').innerText = "âœ… API í‚¤ ì—°ê²° ì™„ë£Œ. ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                document.getElementById('key-status').classList.replace('text-slate-500', 'text-green-400');
            }
        });

        // --- Core UI Functions ---
        function setCurrency(curr) {
            currentCurrency = curr;
            const btnUsd = document.getElementById('btn-usd');
            const btnJpy = document.getElementById('btn-jpy');
            const rowJpy = document.getElementById('row-usdjpy');
            
            if (curr === 'usd') {
                btnUsd.className = 'flex-1 py-2.5 rounded-lg text-sm font-bold transition-all bg-white text-blue-600 shadow-sm';
                btnJpy.className = 'flex-1 py-2.5 rounded-lg text-sm font-bold transition-all text-blue-100 hover:text-white';
                rowJpy.classList.add('hidden');
            } else {
                btnUsd.className = 'flex-1 py-2.5 rounded-lg text-sm font-bold transition-all text-blue-100 hover:text-white';
                btnJpy.className = 'flex-1 py-2.5 rounded-lg text-sm font-bold transition-all bg-white text-blue-600 shadow-sm';
                rowJpy.classList.remove('hidden');
            }
            document.getElementById('result-area').classList.add('hidden');
        }

        function setBias(type, dir) {
            macroBias[type] = dir;
            const container = document.getElementById(`ctrl-${type}`);
            const btns = container.querySelectorAll('button');
            
            btns.forEach(btn => btn.className = "sent-btn");
            
            if (dir === 'up') btns[0].classList.add('active-up');
            else if (dir === 'flat') btns[1].classList.add('active-flat');
            else if (dir === 'down') btns[2].classList.add('active-down');
        }

        async function autoCheckNews() {
            const key = localStorage.getItem('gemini_api_key');
            if (!key) { alert("âš™ï¸ ìƒë‹¨ ì„¤ì •ì—ì„œ API í‚¤ë¥¼ ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”."); return; }

            const loader = document.getElementById('news-loading');
            const newsArea = document.getElementById('news-context');
            loader.classList.remove('hidden');

            const prompt = `
                Act as a professional FX analyst for a Korean Toss Bank user. 
                Search and analyze the LATEST economic news for ${currentCurrency === 'usd' ? 'USD/KRW and Dollar Index' : 'JPY/KRW and USD/JPY'}.
                Provide a 2-sentence summary in Korean focusing on what is happening RIGHT NOW.
                Then, suggest if the sentiment is 'Strong', 'Neutral', or 'Weak'.
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: prompt }] }],
                        tools: [{ "google_search": {} }]
                    })
                });
                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                newsArea.value = text.trim();
                
                // Smart sentiment detection (Auto-toggle buttons)
                if(text.includes('ê°•ì„¸') || text.includes('ìƒìŠ¹')) setBias('dxy', 'up');
                else if(text.includes('ì•½ì„¸') || text.includes('í•˜ë½')) setBias('dxy', 'down');
                else setBias('dxy', 'flat');

            } catch (e) {
                newsArea.value = "ì´ìŠˆ ì²´í¬ ì‹¤íŒ¨. ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” í‚¤ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.";
            } finally {
                loader.classList.add('hidden');
            }
        }

        function toggleSettings() {
            const area = document.getElementById('settings-area');
            area.classList.toggle('hidden');
        }

        function saveApiKey() {
            const key = document.getElementById('api-key-input').value.trim();
            if (key) {
                localStorage.setItem('gemini_api_key', key);
                location.reload();
            }
        }

        // --- Data Fetching ---
        async function fetchHistoricalData() {
            try {
                const startStr = new Date(Date.now() - 40 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
                const [usdRes, jpyRes] = await Promise.all([
                    fetch(`${HISTORY_API}/${startStr}..?from=USD&to=KRW`),
                    fetch(`${HISTORY_API}/${startStr}..?from=JPY&to=KRW`)
                ]);
                const usdData = await usdRes.json();
                const jpyData = await jpyRes.json();
                historicalData.usd = Object.values(usdData.rates).map(r => r.KRW);
                historicalData.jpy = Object.values(jpyData.rates).map(r => r.KRW * 100);
            } catch (e) { console.error("Data error", e); }
        }

        // --- Analysis Logic ---
        async function analyzePrice() {
            const inputVal = parseFloat(document.getElementById('price-input').value);
            if (!inputVal) { alert("í˜„ì¬ê°€ë¥¼ ì…ë ¥í•˜ì„¸ìš”."); return; }

            document.getElementById('loading-overlay').classList.remove('hidden');
            
            setTimeout(async () => {
                const history = currentCurrency === 'usd' ? historicalData.usd : historicalData.jpy;
                const tech = calculateTechnicals(inputVal, history);
                const final = applyFundamentalWeights(tech, inputVal);
                
                updateUI(final, inputVal);
                
                try {
                    const comment = await getGeminiBriefing(inputVal, final);
                    document.getElementById('ai-comment').innerHTML = comment;
                } catch (e) {
                    document.getElementById('ai-comment').innerText = e.message;
                }

                document.getElementById('loading-overlay').classList.add('hidden');
                document.getElementById('result-area').classList.remove('hidden');
                window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
            }, 800);
        }

        function calculateTechnicals(price, history) {
            const last = history[history.length - 1];
            let volSum = 0;
            for(let i=14; i>0; i--) volSum += Math.abs(history[history.length-i] - history[history.length-i-1]);
            let atr = volSum / 14;
            const rsi = (function(h){
                let g=0, l=0;
                for(let i=h.length-14; i<h.length; i++){
                    let d = h[i]-h[i-1]; d>0?g+=d:l-=d;
                }
                let rs = (g/14)/(l/14); return 100-(100/(1+rs));
            })(history);
            const ma5 = history.slice(-5).reduce((a,b)=>a+b, 0)/5;
            return { rsi, pivot: last, ma5, atr };
        }

        function applyFundamentalWeights(tech, price) {
            let bias = 0;
            const isVolMode = document.getElementById('vol-mode').checked;
            if (macroBias.dxy === 'up') bias += 1.2;
            else if (macroBias.dxy === 'down') bias -= 1.2;
            if (currentCurrency === 'jpy') {
                if (macroBias.usdjpy === 'up') bias -= 1.8;
                else if (macroBias.usdjpy === 'down') bias += 1.8;
            }
            let spread = tech.atr * (isVolMode ? 1.8 : 0.8);
            let entry = tech.pivot - (spread * 0.5) + (bias * 3.5);
            let exit = tech.pivot + (spread * 0.5) + (bias * 3.5);
            const minP = currentCurrency === 'usd' ? 6 : 4;
            if (exit - entry < minP) exit = entry + minP;
            let verdict = "ê´€ë§ (Neutral)";
            let color = "slate";
            if (price < entry) { verdict = "ì ê·¹ ë§¤ìˆ˜ (Strong Buy)"; color = "green"; }
            else if (price > exit) { verdict = "ì ê·¹ ë§¤ë„ (Strong Sell)"; color = "red"; }
            return { ...tech, entry, exit, verdict, color, bias, isVolMode };
        }

        function updateUI(res, price) {
            const vTitle = document.getElementById('verdict-title');
            const vBg = document.getElementById('verdict-bg');
            const vIcon = document.getElementById('verdict-icon');
            vTitle.innerText = res.verdict;
            document.getElementById('vol-badge').style.display = res.isVolMode ? 'inline-block' : 'none';
            if (res.color === 'green') {
                vBg.className = "absolute top-0 left-0 w-2 h-full bg-green-500";
                vIcon.innerHTML = '<i class="fas fa-arrow-circle-up text-green-500"></i>';
                document.getElementById('verdict-desc').innerText = "ìƒìŠ¹ ì••ë ¥ì´ ë§¤ìš° ê°•í•©ë‹ˆë‹¤. ì§„ì…í•˜ê¸° ì¢‹ì€ ê°€ê²©ëŒ€ì…ë‹ˆë‹¤.";
            } else if (res.color === 'red') {
                vBg.className = "absolute top-0 left-0 w-2 h-full bg-red-500";
                vIcon.innerHTML = '<i class="fas fa-arrow-circle-down text-red-500"></i>';
                document.getElementById('verdict-desc').innerText = "ë‹¨ê¸° ê³ ì  ë„ë‹¬. ìˆ˜ìµ ì‹¤í˜„ í˜¹ì€ ê´€ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.";
            } else {
                vBg.className = "absolute top-0 left-0 w-2 h-full bg-slate-400";
                vIcon.innerHTML = '<i class="fas fa-pause-circle text-slate-300"></i>';
                document.getElementById('verdict-desc').innerText = "ì¶”ì„¸ê°€ ë¶ˆë¶„ëª…í•©ë‹ˆë‹¤. ë‹¤ìŒ íƒ€ì ì„ ê¸°ë‹¤ë¦¬ì„¸ìš”.";
            }
            document.getElementById('target-entry').innerText = Math.floor(res.entry).toLocaleString() + "ì›";
            document.getElementById('target-exit').innerText = Math.floor(res.exit).toLocaleString() + "ì›";
            const gap = Math.floor(res.entry - price);
            document.getElementById('entry-gap').innerText = gap >= 0 ? `í˜„ì¬ê°€ ëŒ€ë¹„ +${gap}ì›` : `í˜„ì¬ê°€ ëŒ€ë¹„ ${gap}ì›`;
            document.getElementById('profit-calc').innerText = `í‹±ë‹¹ ìˆ˜ìµ: +${Math.floor(res.exit - res.entry)}ì›`;
            document.getElementById('rsi-val').innerText = res.rsi.toFixed(1);
            document.getElementById('pivot-val').innerText = Math.floor(res.pivot);
            document.getElementById('ma5-val').innerText = Math.floor(res.ma5);
        }

        async function getGeminiBriefing(price, res) {
            const key = localStorage.getItem('gemini_api_key');
            const news = document.getElementById('news-context').value;
            const prompt = `ë‹¹ì‹ ì€ í™˜í…Œí¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ìƒí™©: ${currentCurrency.toUpperCase()}, ê°€ê²© ${price}ì›. ì§€í‘œ: RSI ${res.rsi.toFixed(1)}, Pivot ${Math.floor(res.pivot)}. ë‰´ìŠ¤ì´ìŠˆ: ${news}. 3ì¤„ ì´ë‚´ë¡œ ëª…í™•í•˜ê²Œ ì „ëµ ë¸Œë¦¬í•‘ì„ í•´ì£¼ì„¸ìš”.`;
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text.replace(/\n/g, '<br>');
            } catch (e) { throw new Error("AI ì—°ê²° ì§€ì—°ë¨."); }
        }
    </script>
</body>
</html>
